<!DOCTYPE html>
<html>
  <head>
    <title>XPAD_PLUS PROTECTED INVENTORY</title>
    <link rel="stylesheet" type="text/css" href="/style.css" />
  </head>

  <body>
    <div class="container0">
      <div class="container1">
        <div class="container2">
          <label style="position: relative; top: 20px" class="SMTX"
            >XPAD_PLUS</label
          >
        </div>
        <div class="container2">
          <button onclick="window.location.href='/'">HOME</button>
        </div>
      </div>

      <div
        style="display: flex; flex-direction: column; align-items: center"
        class="container1"
      >
        <form
          action="/save_protected_inventory"
          method="POST"
          target="hidden_iframe"
        >
          <div id="table_div" class="container1">
            <table id="config_table">
              <thead>
                <tr>
                  <th><h1>PARAMETER</h1></th>
                  <th><h1>VALUE</h1></th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>
                    <label>ENABLE:</label>
                  </td>
                  <td>
                    <select
                      name="enabled"
                      id="enabled"
                      class="placeholder_style"
                    >
                      <option value="false">OFF</option>
                      <option value="true">ON</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td>
                    <label>PASSWORD:</label>
                  </td>
                  <td>
                    <input
                      type="text"
                      class="placeholder_style"
                      name="password"
                      id="password"
                      placeholder="Enter 8 hexadecimal digits (example: 12345678)"
                      maxlength="8"
                      pattern="[0-9A-Fa-f]{8}"
                      title="8 hexadecimal digits (0-9, A-F)"
                      style="width: 400px"
                    />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="container1">
            <button type="submit">SAVE CONFIG</button>
          </div>
        </form>

        <div class="container1">
          <div id="table_div" class="container1">
            <table class="table_2" id="current_config_table">
              <thead>
                <tr>
                  <th>CURRENT CONFIG</th>
                  <th>VALUE</th>
                </tr>
              </thead>
              <tbody id="current_config_body">
                <!-- Dados serão carregados via JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <iframe name="hidden_iframe" style="display: none"></iframe>
      </div>
    </div>

    <script>
      // Função para carregar configuração atual
      function loadCurrentConfig() {
        fetch("/get_protected_inventory")
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("enabled").value = data.enabled.toString();
            document.getElementById("password").value = data.password;
          })
          .catch((error) => console.error("Error:", error));
      }

      // Função para atualizar tabela de configuração atual
      function updateCurrentConfigTable() {
        fetch("/table_protected_inventory_att")
          .then((response) => response.json())
          .then((data) => {
            const tbody = document.getElementById("current_config_body");
            tbody.innerHTML = "";

            data.forEach((item) => {
              const row = tbody.insertRow();
              const cell1 = row.insertCell(0);
              const cell2 = row.insertCell(1);
              cell1.innerHTML = `${item[0]}`;
              cell2.innerHTML = item[1];
            });
          })
          .catch((error) => console.error("Error:", error));
      }

      // Carregar dados ao carregar a página
      document.addEventListener("DOMContentLoaded", function () {
        loadCurrentConfig();
        updateCurrentConfigTable();
      });

      // Atualizar dados a cada 2 segundos
      setInterval(() => {
        updateCurrentConfigTable();
      }, 2000);

      // Recarregar configuração após salvar
      document.querySelector("form").addEventListener("submit", function (e) {
        setTimeout(() => {
          loadCurrentConfig();
          updateCurrentConfigTable();
        }, 500);
      });

      // Validação do campo password
      document
        .getElementById("password")
        .addEventListener("input", function (e) {
          const value = e.target.value.toUpperCase();
          e.target.value = value;

          // Validar se são apenas caracteres hexadecimais
          if (!/^[0-9A-F]*$/.test(value)) {
            e.target.setCustomValidity(
              "Apenas caracteres hexadecimais (0-9, A-F) são permitidos"
            );
          } else if (value.length !== 8 && value.length !== 0) {
            e.target.setCustomValidity(
              "A senha deve ter exatamente 8 caracteres hexadecimais"
            );
          } else {
            e.target.setCustomValidity("");
          }
        });
    </script>
  </body>
</html>
